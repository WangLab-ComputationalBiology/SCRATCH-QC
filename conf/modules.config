process {

    withName: "SEURAT_QUALITY" {
        ext.args = {
            [
                params.project_name ? "project_name:${params.project_name}" : '',
                "work_directory:\$PWD"
            ].join(' -P ').trim()
        }
        publishDir = [
            [
                path: { "${params.outdir}/data/${task.process}/${sample_id}" },
                mode: 'copy',
                overwrite: true
            ],
        ]
    }

    withName: "HELPER_SUMMARIZE" {
        ext.args = {
            [
                params.project_name ? "project_name:${params.project_name}" : '',
                "work_directory:\$PWD"
            ].join(' -P ').trim()
        }
        publishDir = [
            [
                path: { "${params.outdir}/" },
                pattern: 'report/*.html',
                mode: 'copy',
                overwrite: true
            ]
        ]
    }

    withName: "SEURAT_MERGE" {
        ext.args = {
            [
                params.project_name ? "project_name:${params.project_name}" : '',
                "work_directory:\$PWD"
            ].join(' -P ').trim()
        }
        publishDir = [
            [
                path: { "${params.outdir}/data/${task.process}" },
                pattern: '{data/*,figures/*}',
                mode: 'copy',
                overwrite: true
            ],
            [
                path: { "${params.outdir}/" },
                pattern: 'report/*.html',
                mode: 'copy',
                overwrite: true
            ],
        ]
    }

        withName: "SEURAT_NORMALIZE" {
        ext.args = {
            [
                params.project_name ? "project_name:${params.project_name}" : '',
                params.thr_n_features ? "thr_n_features:${params.thr_n_features}" : '',
                params.thr_n_dimensions ? "thr_n_features:${params.thr_n_dimensions}" : '',
                "work_directory:\$PWD"
            ].join(' -P ').trim()
        }
        publishDir = [
            [
                path: { "${params.outdir}/data/${task.process}" },
                pattern: '{data/*,figures/*}',
                mode: 'copy',
                overwrite: true
            ],
            [
                path: { "${params.outdir}/" },
                pattern: 'report/*.html',
                mode: 'copy',
                overwrite: true
            ],
        ]
    }

}
